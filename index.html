<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <!-- ëª¨ë°”ì¼ ìµœì í™”ë¥¼ ìœ„í•œ viewport ì„¤ì • -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì½”ìº£ë°°ì†¡ - ë‘ë”ì§€ ì¡ê¸° ëŒ€ì‘ì „</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #fff;
      font-family: Arial, sans-serif;
      overflow: hidden;
      height: 100%;
    }
    /* í¬ë ˆë”§ ì˜ì—­: í•˜ë‹¨ ê³ ì • */
    #credits {
      width: 100%;
      background: rgba(255,255,255,0.7);
      text-align: center;
      z-index: 2;
      padding: 10px 0;
      box-sizing: border-box;
      position: fixed;
      bottom: 0;
      left: 0;
    }
    #credits div {
      font-size: 14px;
      color: #000;
    }
    /* ê²Œì„ ìº”ë²„ìŠ¤ */
    #gameCanvas {
      background: #eee;
      display: block;
      margin: 0 auto;
      touch-action: none;  /* ë¸Œë¼ìš°ì € ê¸°ë³¸ í„°ì¹˜ ë™ì‘ ë°©ì§€ */
    }
    /* ì‹œì‘ ì „ ì•ˆë‚´ í™”ë©´ (ì˜¤ë²„ë ˆì´) */
    #startScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.9);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      box-sizing: border-box;
      padding: 20px;
    }
    #startScreen h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }
    #startScreen p {
      font-size: 16px;
      margin: 5px 0;
      line-height: 1.4;
    }
    #startBtn {
      margin-top: 20px;
      font-size: 18px;
      padding: 10px 20px;
      background-color: #ff5e5e;
      border: none;
      border-radius: 5px;
      color: #fff;
      cursor: pointer;
    }
    #startBtn:hover {
      background-color: #ff3c3c;
    }
    /* ê²Œì„ ì˜¤ë²„ í™”ë©´ (ì˜¤ë²„ë ˆì´) */
    #gameOverScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      box-sizing: border-box;
      padding: 20px;
      color: #fff;
    }
    #gameOverScreen .message {
      font-size: 24px;
      margin-bottom: 20px;
      line-height: 1.4;
    }
    #restartBtn {
      font-size: 18px;
      padding: 10px 20px;
      background-color: #ff9cda;
      border: none;
      border-radius: 20px;
      color: #fff;
      cursor: pointer;
    }
    #restartBtn:hover {
      background-color: #f66cc7;
    }
  </style>
</head>
<body>
  <!-- ê²Œì„ ìº”ë²„ìŠ¤ -->
  <canvas id="gameCanvas"></canvas>

  <!-- í¬ë ˆë”§ ì˜ì—­: í•˜ë‹¨ì— ê³ ì • -->
  <div id="credits">
    <div>ìœ íŠœë¸Œ 'ì•„ë§ˆë€ìŠ¤ì£¼ë‹ˆí• ë§¤' ì €ì‘ê¶Œ ì½˜í…ì¸ ì…ë‹ˆë‹¤. 
      <a href="https://www.youtube.com/@ì•„ë§ˆë€ìŠ¤ì£¼ë‹ˆí• ë§¤" target="_blank">https://www.youtube.com/@ì•„ë§ˆë€ìŠ¤ì£¼ë‹ˆí• ë§¤</a>
    </div>
    <div>Â© 2025 ì½”ì¼“ê²Œì„ì¦ˆ. All rights reserved</div>
  </div>

  <!-- ì‹œì‘ ì „ ì•ˆë‚´ í™”ë©´ -->
  <div id="startScreen">
    <h1>â¤ï¸ì½”ì¼“ë°°ì†¡ - ë‘ë”ì§€ ì¡ê¸° ëŒ€ì‘ì „ğŸšš</h1>
    <p>ì½”ì¼“ë°°ì†¡ì„ ì¡ìœ¼ë©´ ì ìˆ˜ê°€ ì¦ê°€í•˜ë©°,<br>íƒë°°ë°•ìŠ¤ë¥¼ ì¡ìœ¼ë©´ 5ì´ˆê°€ ì¶”ê°€ë©ë‹ˆë‹¤.</p>
    <p>â¤ï¸90ì´ˆ ê²Œì„ì…ë‹ˆë‹¤â¤ï¸</p>
    <p>ìœ íŠœë¸Œ 'ì•„ë§ˆë€ìŠ¤ì£¼ë‹ˆí• ë§¤' ì €ì‘ê¶Œ ì½˜í…ì¸ ì…ë‹ˆë‹¤.<br>
    <p>Â© 2025 ì½”ì¼“ê²Œì„ì¦ˆ. All rights reserved.<br>
      <a href="https://www.youtube.com/@ì•„ë§ˆë€ìŠ¤ì£¼ë‹ˆí• ë§¤" target="_blank">https://www.youtube.com/@ì•„ë§ˆë€ìŠ¤ì£¼ë‹ˆí• ë§¤</a></p>
    <button id="startBtn">ê²Œì„ ì‹œì‘</button>
  </div>

  <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
  <div id="gameOverScreen">
    <div class="message">
      ê²Œì„ ì˜¤ë²„! ğŸ˜¢<br>
      ì½”íŒ¡ êµ¬ì…ì€ ê±¸ì½”ì™€í•¨ê»˜<br>
      <a href="https://www.youtube.com/@Gulko" target="_blank" style="color:#fff;text-decoration:underline;">
        https://www.youtube.com/@Gulko
      </a><br>
      ì‚¬ë‘í•©ë‹ˆë‹¤. ê³ ê°ë‹˜
    </div>
    <button id="restartBtn">ë‹¤ì‹œ ì‹œì‘</button>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const credits = document.getElementById('credits');

    // ìº”ë²„ìŠ¤ í¬ê¸°ì™€ ê²Œì„ ê·¸ë¦¬ë“œ ì¬ì„¤ì • í•¨ìˆ˜ (ëª¨ë°”ì¼ ë° ì°½ í¬ê¸° ë³€í™” ëŒ€ì‘)
    function resizeCanvas() {
      // ì „ì²´ í™”ë©´ í¬ê¸°ì— ë§ê²Œ ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •, ë‹¨ í¬ë ˆë”§ ì˜ì—­ ë†’ì´ë§Œí¼ ë¹¼ì¤ë‹ˆë‹¤.
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight - credits.clientHeight;
      
      // í¬ë ˆë”§ ì˜ì—­ì€ ìº”ë²„ìŠ¤ì™€ ë¶„ë¦¬ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ìƒë‹¨ ì—¬ë°±ì€ 0ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
      TOP_MARGIN = 0;
      
      cellWidth = canvas.width / COLS;
      cellHeight = (canvas.height - TOP_MARGIN) / ROWS;

      // ê° í™€ì˜ ìœ„ì¹˜ ì¬ì„¤ì •
      holes = [];
      for (let row = 0; row < ROWS; row++) {
        for (let col = 0; col < COLS; col++) {
          const cellX = col * cellWidth;
          const cellY = TOP_MARGIN + row * cellHeight;
          const cx = cellX + cellWidth / 2;
          const cy = cellY + cellHeight / 2;
          const r = Math.min(cellWidth, cellHeight) / 3;
          holes.push({ x: cx, y: cy, r: r, cellX: cellX, cellY: cellY });
        }
      }
    }

    // ê²Œì„ ê¸°ë³¸ ë³€ìˆ˜
    let gameTime = 90; // 90ì´ˆ ê²Œì„ ì‹œê°„
    let startTime = Date.now();
    let lastSpawnTime = 0;
    let score = 0; // ì ìˆ˜ ë³€ìˆ˜
    let moles = [];    // í˜„ì¬ ë“±ì¥ ì¤‘ì¸ ë‘ë”ì§€ ë°°ì—´
    let hitTexts = []; // í„°ì¹˜ íš¨ê³¼ í…ìŠ¤íŠ¸ ë°°ì—´
    let gameRunning = false; // ê²Œì„ ì§„í–‰ ì—¬ë¶€

    // ê·¸ë¦¬ë“œ ê´€ë ¨ ë³€ìˆ˜ (ì´ˆê¸°ê°’: 3í–‰ 4ì—´)
    let ROWS = 3;
    let COLS = 4;
    let cellWidth, cellHeight, TOP_MARGIN;
    let holes = [];

    // ì´ë¯¸ì§€ ë¡œë“œ
    const moleImg = new Image();
    moleImg.src = "1.png"; // ì¼ë°˜ ë‘ë”ì§€ ì´ë¯¸ì§€
    const bonusImg = new Image();
    bonusImg.src = "2.png"; // ë³´ë„ˆìŠ¤ ë‘ë”ì§€ ì´ë¯¸ì§€
    const backImg = new Image();
    backImg.src = "back.png"; // ë°°ê²½ ì´ë¯¸ì§€

    // ì˜¤ë””ì˜¤ ë¡œë“œ
    const audioMole = new Audio("1.mp3");       // ë‘ë”ì§€ ë“±ì¥ íš¨ê³¼ìŒ
    const audioAttack = new Audio("attack.mp3");  // ì¼ë°˜ í„°ì¹˜ íš¨ê³¼ìŒ
    const audioBonus = new Audio("2.mp3");        // ë³´ë„ˆìŠ¤ í„°ì¹˜ íš¨ê³¼ìŒ
    const bgm = new Audio("bgm.mp3");             // ë°°ê²½ìŒì•…
    bgm.loop = true;
    bgm.volume = 0.5;

    // ìë™ ì¬ìƒ ì œí•œ ëŒ€ì‘: ì‚¬ìš©ì ì²« í´ë¦­/í„°ì¹˜ ì‹œ bgm ì¬ìƒ
    let bgmStarted = false;
    function startBGM() {
      if (!bgmStarted) {
        bgm.currentTime = 0;
        bgm.play().catch(() => {});
        bgmStarted = true;
      }
    }
    canvas.addEventListener("pointerdown", startBGM);
    document.getElementById("startBtn").addEventListener("pointerdown", startBGM);
    document.getElementById("restartBtn").addEventListener("pointerdown", () => {
      bgm.currentTime = 0;
      bgm.play().catch(() => {});
      bgmStarted = true;
    });

    // Mole í´ë˜ìŠ¤ (ë‘ë”ì§€ ê°ì²´)
    class Mole {
      constructor(holeIndex, bonus = false, elapsed = 0) {
        this.holeIndex = holeIndex;
        this.hole = holes[holeIndex];
        this.bonus = bonus;
        this.appearTime = Date.now();
        let baseDuration = 800 + Math.random() * 400;
        let speedFactor = Math.max(0.6, 1 - elapsed / 100);
        this.duration = baseDuration * speedFactor;
        this.hit = false;
        this.moleSize = this.hole.r * 2 - 10;
        this.baseX = this.hole.x - this.moleSize / 2;
        this.hiddenY = this.hole.y;
        this.visibleY = this.hole.y - this.moleSize;
      }
      getCurrentY() {
        let now = Date.now();
        let progress = (now - this.appearTime) / this.duration;
        if (progress > 1) progress = 1;
        if (progress < 0.5) {
          return this.hiddenY - (progress / 0.5) * (this.hiddenY - this.visibleY);
        } else {
          return this.visibleY + ((progress - 0.5) / 0.5) * (this.hiddenY - this.visibleY);
        }
      }
      draw() {
        ctx.save();
        ctx.beginPath();
        ctx.arc(this.hole.x, this.hole.y, this.hole.r, 0, Math.PI * 2);
        ctx.clip();
        const currentY = this.getCurrentY();
        if (this.bonus) {
          ctx.drawImage(bonusImg, this.baseX, currentY, this.moleSize, this.moleSize);
        } else {
          ctx.drawImage(moleImg, this.baseX, currentY, this.moleSize, this.moleSize);
        }
        ctx.restore();
      }
      isClicked(mx, my) {
        const currentY = this.getCurrentY();
        return mx >= this.baseX && mx <= this.baseX + this.moleSize &&
               my >= currentY && my <= currentY + this.moleSize;
      }
    }

    // ê²Œì„ ë£¨í”„ í•¨ìˆ˜
    function gameLoop() {
      if (!gameRunning) return; // ê²Œì„ì´ ì§„í–‰ ì¤‘ì¼ ë•Œë§Œ ë£¨í”„ ì‹¤í–‰

      const now = Date.now();
      const elapsed = (now - startTime) / 1000;
      const remaining = gameTime - elapsed;
      const effectiveSpawnInterval = Math.max(200, 600 - elapsed * 5);

      if (remaining <= 0) {
        gameOver();
        return;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#eee";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(backImg, 0, TOP_MARGIN, canvas.width, canvas.height - TOP_MARGIN);

      holes.forEach(hole => {
        ctx.beginPath();
        ctx.arc(hole.x, hole.y, hole.r, 0, Math.PI * 2);
        ctx.fillStyle = "white";
        ctx.fill();
        ctx.lineWidth = 2;
        ctx.strokeStyle = "black";
        ctx.stroke();
      });

      if (now - lastSpawnTime > effectiveSpawnInterval) {
        const occupied = moles.map(m => m.holeIndex);
        const available = holes.map((h, i) => i).filter(i => !occupied.includes(i));
        if (available.length > 0) {
          const index = available[Math.floor(Math.random() * available.length)];
          const bonus = Math.random() < 0.15;
          moles.push(new Mole(index, bonus, elapsed));
          if (audioMole.paused) {
            audioMole.currentTime = 0;
            audioMole.play().catch(() => {});
          }
          lastSpawnTime = now;
        }
      }

      moles = moles.filter(mole => {
        if (now - mole.appearTime > mole.duration || mole.hit) {
          return false;
        }
        mole.draw();
        return true;
      });

      hitTexts = hitTexts.filter(ht => {
        if (now - ht.time < ht.duration) {
          ctx.font = "20px Arial";
          ctx.fillStyle = ht.color;
          ctx.fillText(ht.text, ht.x, ht.y);
          return true;
        }
        return false;
      });

      ctx.font = "20px Arial";
      ctx.fillStyle = "red";
      ctx.fillText("Time: " + Math.max(0, Math.floor(remaining)) + " | Score: " + score, 10, TOP_MARGIN + 25);

      requestAnimationFrame(gameLoop);
    }

    // ê²Œì„ ì˜¤ë²„ ì²˜ë¦¬
    function gameOver() {
      gameRunning = false;
      bgm.pause();
      document.getElementById("gameOverScreen").style.display = 'flex';
    }

    // ê²Œì„ ì¬ì‹œì‘ í•¨ìˆ˜
    function restartGame() {
      score = 0;
      moles = [];
      hitTexts = [];
      gameTime = 90;
      startTime = Date.now();
      lastSpawnTime = 0;
      
      // bgm ì¬ìƒì„ ìœ„í•´ ì¬ì„¤ì •
      bgm.currentTime = 0;
      bgm.play().catch(() => {});
      bgmStarted = true;
      
      document.getElementById("gameOverScreen").style.display = 'none';
      gameRunning = true;
      requestAnimationFrame(gameLoop);
    }

    // ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ ê²Œì„ ì‹œì‘
    document.getElementById("startBtn").addEventListener("pointerdown", function() {
      document.getElementById("startScreen").style.display = 'none';
      startTime = Date.now();
      gameRunning = true;
      requestAnimationFrame(gameLoop);
    });

    // ë‹¤ì‹œ ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ ê²Œì„ ì¬ì‹œì‘
    document.getElementById("restartBtn").addEventListener("pointerdown", function() {
      restartGame();
    });

    // pointerdown ì´ë²¤íŠ¸ ì²˜ë¦¬ (ê²Œì„ ì¤‘ ì…ë ¥)
    canvas.addEventListener("pointerdown", function(e) {
      if (!gameRunning) return;
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      moles.forEach(mole => {
        if (!mole.hit && mole.isClicked(mx, my)) {
          mole.hit = true;
          score++;
          let now = Date.now();
          if (mole.bonus) {
            gameTime += 5;
            hitTexts.push({ 
              text: "ìƒ¤ë°”ë¼", 
              x: mole.baseX, 
              y: mole.getCurrentY(), 
              time: now, 
              duration: 1000, 
              color: "green" 
            });
            audioBonus.currentTime = 0;
            audioBonus.play().catch(() => {});
          } else {
            hitTexts.push({ 
              text: "ë¶„ë°œì•ˆí•˜ëƒ", 
              x: mole.baseX, 
              y: mole.getCurrentY(), 
              time: now, 
              duration: 1000, 
              color: "blue" 
            });
            audioAttack.currentTime = 0;
            audioAttack.play().catch(() => {});
          }
        }
      });
    });

    // ì°½ í¬ê¸° ë³€í™” ì‹œ ìº”ë²„ìŠ¤ ì¬ì„¤ì •
    window.addEventListener("resize", resizeCanvas);

    // ì´ˆê¸° ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
    resizeCanvas();
  </script>
</body>
</html>
